webpackJsonp([7],{81:function(s,a){s.exports='<h1 id="-">博客域名优化配置说明</h1>\n<h3 id="-others-">分类: [Others]</h3>\n<hr>\n<p>决定在 <code>GitHub Pages</code> 搞个静态博客的时候, 我就想要尽可能的加快打开速度, 因此使用了一些雕虫小技来加快打开速度, 提高用户体验.</p>\n<h2 id="-">优化</h2>\n<h2 id="-cdn-">使用百度 CDN 服务和七牛静态资源托管</h2>\n<p>本博客使用了 <code>Bootstrap/jQuery/fontawsome</code> 这三个库/字体文件, 因为 <code>Bootstrap</code> 我根据实际情况, 自己修改了些许内容以更加配合排版, 因此没有使用第三方的 <code>CDN</code>, 而是放在了七牛的资源服务器上, <code>jQuery</code> 使用的则是百度的静态公共资源服务.</p>\n<p>这里打个广告吧, 对于个人用户而言, 七牛在使用支付宝实名认证之后, 有 10G 的免费存储空间, 从实际效果看, 速度还是可以的, 我把域名 <code>img.xheldon.com CNAME</code> 到了七牛的资源服务器, 以供一些静态资源如上述的定制版 <code>Bootstrap</code> 和图片, 因此使用的时候只需要上传文件写好路径即可, 然后使用 <code>img.xheldon.com/path/filename.ext</code> 即可:</p>\n<p><img src="http://img.xheldon.com/img/qiniu.png" alt="七牛服务" title="七牛服务"></p>\n<p>说实话, 因为是静态博客, 所以请求带的 <code>Cookie</code> 不是很大, 因此将资源放到另一个二级域名的优化的作用不是很大, 不过聊胜于无.</p>\n<h2 id="-">将小资源直接放到页面中</h2>\n<p>我将一些小的 <code>css</code> 和 <code>js</code> 直接放到页面中, 如 <code>highlight.css</code> 和 <code>search.js</code>, 都通过 <code>style</code> 和 <code>script</code> 标签直接写到了页面中, 这样做的好处是很大的, 因为这两个文件小, 下载文件所需要的时间可以忽略不计, 如果使用外部引入的形式, 那么加载这两个文件的时间主要消耗在了 <a href="https://developers.google.com/web/tools/chrome-devtools/network-performance/reference#timing" target="_blank"><code>TTFB</code></a> (需FQ)上了: </p>\n<p><img src="http://img.xheldon.com/img/TTFB.png" alt="TTFB" title="TTFB"></p>\n<h2 id="-">设置</h2>\n<p>因为年轻的时候没有见过世面, 于是直接将本站的 <code>A</code> 记录的 <code>www</code> 指向了 <code>Github Pages</code> 的 <code>IP 192.30.252.154/192.30.252.153</code>, 而把顶级域名 <code>@</code> 错误的使用 <code>CNAME</code> 指向了 <code>xheldon.github.io.</code>, 其实如果你没有 <code>MX</code> 指向 <code>@</code> 的话, 这样做是 <code>OK</code> 的, 但是因为我想在写简历的时候搞的酷一点, 使用自己博客的域名作为邮箱, 然后使用了 <code>QQ</code> 邮箱提供的域名邮箱服务, 因此在做 <code>MX</code> 解析的时候, 需要将顶级域名 <code>@</code>\n指向腾讯的 <code>mxdomain.qq.com</code>, 这个时候就报错了, 阿里云提示说 <code>CNAME</code> 和 <code>MX</code> 不能都指向顶级域名 <code>@</code>, 具体原因可以<a href="https://www.zhihu.com/question/21128056" target="_blank">看这里</a>, 但是到现在博客已经迁移几个月了, 一些链接也已经被搜索引擎抓取过了, 现在再修改的话链接的话损失有点大. </p>\n<p>我最开始的配置是这样的:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:center">记录类型</th>\n<th style="text-align:center">主机记录</th>\n<th style="text-align:center">记录值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:center">CNAME</td>\n<td style="text-align:center">@</td>\n<td style="text-align:center">xheldon.github.io.</td>\n</tr>\n<tr>\n<td style="text-align:center">A</td>\n<td style="text-align:center">www</td>\n<td style="text-align:center">192.30.252.154</td>\n</tr>\n<tr>\n<td style="text-align:center">A</td>\n<td style="text-align:center">www</td>\n<td style="text-align:center">192.30.252.153</td>\n</tr>\n</tbody>\n</table>\n<p>因为使用腾讯域名邮箱, 所以需要做 <code>MX</code> 记录到 <code>@</code>, 而 <code>MX</code> 的 <code>@</code> 不能和 <code>CNAME</code> 的 <code>@</code> 共存, 于是我想到了隐形 <code>URL</code> 转发, 取消了 <code>CNAME</code> 指向 <code>@</code>, 增加了 <code>MX</code> 记录指向 <code>@</code> ,然后新增了隐性 <code>URL</code>:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:center">记录类型</th>\n<th style="text-align:center">主机记录</th>\n<th style="text-align:center">记录值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:center">A</td>\n<td style="text-align:center">www</td>\n<td style="text-align:center">192.30.252.154</td>\n</tr>\n<tr>\n<td style="text-align:center">A</td>\n<td style="text-align:center">www</td>\n<td style="text-align:center">192.30.252.153</td>\n</tr>\n<tr>\n<td style="text-align:center">MX</td>\n<td style="text-align:center">@</td>\n<td style="text-align:center">mxdomain.qq.com.</td>\n</tr>\n<tr>\n<td style="text-align:center">CNAME</td>\n<td style="text-align:center">qqmailhash</td>\n<td style="text-align:center">mail.qq.com.</td>\n</tr>\n<tr>\n<td style="text-align:center">隐形URL</td>\n<td style="text-align:center">@</td>\n<td style="text-align:center">www.xheldon.com</td>\n</tr>\n</tbody>\n</table>\n<p>同时将博客分支目录的 <code>CNAME</code> 文件从 <code>xheldon.com</code> 改成了 <code>www.xheldon.com</code> 然后发现从搜索引擎访问博客的话, 比如 <code>xheldon.com/about/</code>, 确实是跳转到了这个博客, 但是仅仅停留在首页! 也就是说, 之前被搜索引擎抓取的任何链接都只停留在首页 <code>www.xheldon.com</code> 这个地方, 这就意味着, 隐性转发的作用其实是对特定的地址做跳转, 并不会将地址后的路径自动加上去, 就比如我的情况, 隐形 <code>URL</code> 转发, 设置了从 <code>xheldon.com</code> 转发到 <code>www.xheldon.com</code> 之后, 所有的访问 <code>xheldon.com/xxxx</code> 的请求, 也都被转发到了 <code>www.xheldon.com</code>, 而不是期望的 <code>www.xheldon.com/xxxx</code>.</p>\n<p>此时 <code>dig xheldon.com</code>:</p>\n<pre><code class="hljs bash">; &lt;&lt;&gt;&gt; <span class="hljs-selector-tag">DiG</span> 9<span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.3-P1</span> &lt;&lt;&gt;&gt; <span class="hljs-selector-tag">xheldon</span><span class="hljs-selector-class">.com</span>\n;; <span class="hljs-selector-tag">global</span> <span class="hljs-selector-tag">options</span>: +<span class="hljs-selector-tag">cmd</span>\n;; <span class="hljs-selector-tag">Got</span> <span class="hljs-selector-tag">answer</span>:\n;; <span class="hljs-selector-tag">-</span>&gt;&gt;<span class="hljs-selector-tag">HEADER</span>&lt;&lt;<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">opcode</span>: <span class="hljs-selector-tag">QUERY</span>, <span class="hljs-selector-tag">status</span>: <span class="hljs-selector-tag">NOERROR</span>, <span class="hljs-selector-tag">id</span>: 20871\n;; <span class="hljs-selector-tag">flags</span>: <span class="hljs-selector-tag">qr</span> <span class="hljs-selector-tag">rd</span> <span class="hljs-selector-tag">ra</span>; <span class="hljs-selector-tag">QUERY</span>: 1, <span class="hljs-selector-tag">ANSWER</span>: 1, <span class="hljs-selector-tag">AUTHORITY</span>: 0, <span class="hljs-selector-tag">ADDITIONAL</span>: 0\n\n;; <span class="hljs-selector-tag">QUESTION</span> <span class="hljs-selector-tag">SECTION</span>:\n;<span class="hljs-selector-tag">xheldon</span><span class="hljs-selector-class">.com</span>.            <span class="hljs-selector-tag">IN</span>    <span class="hljs-selector-tag">A</span>\n\n;; <span class="hljs-selector-tag">ANSWER</span> <span class="hljs-selector-tag">SECTION</span>:\n<span class="hljs-selector-tag">xheldon</span><span class="hljs-selector-class">.com</span>.        585    <span class="hljs-selector-tag">IN</span>    <span class="hljs-selector-tag">A</span>    42<span class="hljs-selector-class">.156</span><span class="hljs-selector-class">.141</span><span class="hljs-selector-class">.13</span>\n\n;; <span class="hljs-selector-tag">Query</span> <span class="hljs-selector-tag">time</span>: 7 <span class="hljs-selector-tag">msec</span>\n;; <span class="hljs-selector-tag">SERVER</span>: 172<span class="hljs-selector-class">.168</span><span class="hljs-selector-class">.200</span><span class="hljs-selector-class">.110</span><span class="hljs-selector-id">#53</span>(172<span class="hljs-selector-class">.168</span><span class="hljs-selector-class">.200</span><span class="hljs-selector-class">.110</span>)\n;; <span class="hljs-selector-tag">WHEN</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Mar</span> 30 10<span class="hljs-selector-pseudo">:06</span><span class="hljs-selector-pseudo">:41</span> 2017\n;; <span class="hljs-selector-tag">MSG</span> <span class="hljs-selector-tag">SIZE</span>  <span class="hljs-selector-tag">rcvd</span>: 45\n</code></pre>\n<p>发现顶级域名指向的是阿里云的一个 <code>IP</code>.</p>\n<p>于是我想了下, 修改了一下 <code>A</code> 记录的 <code>@</code> , 将其直接指向 <code>GitHub Pages</code> 的 <code>IP</code> 地址, 而博客根目录的 <code>CNAME</code> 文件内容是修改后的 <code>www.xheldon.com</code>:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:center">记录类型</th>\n<th style="text-align:center">主机记录</th>\n<th style="text-align:center">记录值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:center">A</td>\n<td style="text-align:center">@</td>\n<td style="text-align:center">192.30.252.154</td>\n</tr>\n<tr>\n<td style="text-align:center">A</td>\n<td style="text-align:center">@</td>\n<td style="text-align:center">192.30.252.153</td>\n</tr>\n<tr>\n<td style="text-align:center">MX</td>\n<td style="text-align:center">@</td>\n<td style="text-align:center">mxdomain.qq.com</td>\n</tr>\n<tr>\n<td style="text-align:center">CNAME</td>\n<td style="text-align:center">qqmailhash</td>\n<td style="text-align:center">mail.qq.com.</td>\n</tr>\n<tr>\n<td style="text-align:center">CNAME</td>\n<td style="text-align:center">www</td>\n<td style="text-align:center">github.xheldon.com.</td>\n</tr>\n</tbody>\n</table>\n<p>之所以可以这么做, 是因为 <code>Github Pages</code> <a href="https://help.github.com/articles/setting-up-an-apex-domain-and-www-subdomain/" target="_blank">自动匹配</a>, 具体解释起来就是: </p>\n<ol>\n<li>如果 <code>CNAME</code> 文件内容是 <code>www.xheldon.com</code>, 而发现有来自 <code>xheldon.com</code> 的请求时候(需要配置顶级域名 <code>@</code> 的 <code>A</code> 记录指向 <code>GitHub Pages</code> 的 <code>IP</code> 实现), 就转发到 <code>www.xheldon.com</code>.</li>\n<li>如果 <code>CNAME</code> 文件内容是 <code>xheldon.com</code>, 而发现有来自 <code>www.xheldon.com</code> 的请求时候(需要配置 <code>www</code> 的二级域名 <code>A</code> 记录指向 <code>GitHub Pages</code> 的 <code>IP</code> 实现), 就转发到 <code>xheldon.com</code>.</li>\n</ol>\n<p>这个时候 <code>dig www.xheldon.com</code> 发现:</p>\n<pre><code class="hljs javascript">; &lt;&lt;&gt;&gt; <span class="hljs-selector-tag">DiG</span> 9<span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.3-P1</span> &lt;&lt;&gt;&gt; <span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.xheldon</span><span class="hljs-selector-class">.com</span>\n;; <span class="hljs-selector-tag">global</span> <span class="hljs-selector-tag">options</span>: +<span class="hljs-selector-tag">cmd</span>\n;; <span class="hljs-selector-tag">Got</span> <span class="hljs-selector-tag">answer</span>:\n;; <span class="hljs-selector-tag">-</span>&gt;&gt;<span class="hljs-selector-tag">HEADER</span>&lt;&lt;<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">opcode</span>: <span class="hljs-selector-tag">QUERY</span>, <span class="hljs-selector-tag">status</span>: <span class="hljs-selector-tag">NOERROR</span>, <span class="hljs-selector-tag">id</span>: 56061\n;; <span class="hljs-selector-tag">flags</span>: <span class="hljs-selector-tag">qr</span> <span class="hljs-selector-tag">rd</span> <span class="hljs-selector-tag">ra</span>; <span class="hljs-selector-tag">QUERY</span>: 1, <span class="hljs-selector-tag">ANSWER</span>: 3, <span class="hljs-selector-tag">AUTHORITY</span>: 0, <span class="hljs-selector-tag">ADDITIONAL</span>: 0\n\n;; <span class="hljs-selector-tag">QUESTION</span> <span class="hljs-selector-tag">SECTION</span>:\n;<span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.xheldon</span><span class="hljs-selector-class">.com</span>.        <span class="hljs-selector-tag">IN</span>    <span class="hljs-selector-tag">A</span>\n\n;; <span class="hljs-selector-tag">ANSWER</span> <span class="hljs-selector-tag">SECTION</span>:\n<span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.xheldon</span><span class="hljs-selector-class">.com</span>.    600    <span class="hljs-selector-tag">IN</span>    <span class="hljs-selector-tag">CNAME</span>    <span class="hljs-selector-tag">xheldon</span><span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.io</span>.\n<span class="hljs-selector-tag">xheldon</span><span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.io</span>.    3600    <span class="hljs-selector-tag">IN</span>    <span class="hljs-selector-tag">CNAME</span>    <span class="hljs-selector-tag">github</span><span class="hljs-selector-class">.map</span><span class="hljs-selector-class">.fastly</span><span class="hljs-selector-class">.net</span>.\n<span class="hljs-selector-tag">github</span><span class="hljs-selector-class">.map</span><span class="hljs-selector-class">.fastly</span><span class="hljs-selector-class">.net</span>.  28  <span class="hljs-selector-tag">IN</span>      <span class="hljs-selector-tag">A</span>      151<span class="hljs-selector-class">.101</span><span class="hljs-selector-class">.100</span><span class="hljs-selector-class">.133</span>\n\n;; <span class="hljs-selector-tag">Query</span> <span class="hljs-selector-tag">time</span>: 178 <span class="hljs-selector-tag">msec</span>\n;; <span class="hljs-selector-tag">SERVER</span>: 172<span class="hljs-selector-class">.168</span><span class="hljs-selector-class">.200</span><span class="hljs-selector-class">.110</span><span class="hljs-selector-id">#53</span>(172<span class="hljs-selector-class">.168</span><span class="hljs-selector-class">.200</span><span class="hljs-selector-class">.110</span>)\n;; <span class="hljs-selector-tag">WHEN</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Mar</span> 30 10<span class="hljs-selector-pseudo">:20</span><span class="hljs-selector-pseudo">:30</span> 2017\n;; <span class="hljs-selector-tag">MSG</span> <span class="hljs-selector-tag">SIZE</span>  <span class="hljs-selector-tag">rcvd</span>: 115\n</code></pre>\n<p><code>dig xheldon.com</code> 发现: </p>\n<pre><code class="hljs javascript">; &lt;&lt;&gt;&gt; <span class="hljs-selector-tag">DiG</span> 9<span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.3-P1</span> &lt;&lt;&gt;&gt; <span class="hljs-selector-tag">xheldon</span><span class="hljs-selector-class">.com</span>\n;; <span class="hljs-selector-tag">global</span> <span class="hljs-selector-tag">options</span>: +<span class="hljs-selector-tag">cmd</span>\n;; <span class="hljs-selector-tag">Got</span> <span class="hljs-selector-tag">answer</span>:\n;; <span class="hljs-selector-tag">-</span>&gt;&gt;<span class="hljs-selector-tag">HEADER</span>&lt;&lt;<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">opcode</span>: <span class="hljs-selector-tag">QUERY</span>, <span class="hljs-selector-tag">status</span>: <span class="hljs-selector-tag">NOERROR</span>, <span class="hljs-selector-tag">id</span>: 59875\n;; <span class="hljs-selector-tag">flags</span>: <span class="hljs-selector-tag">qr</span> <span class="hljs-selector-tag">rd</span> <span class="hljs-selector-tag">ra</span>; <span class="hljs-selector-tag">QUERY</span>: 1, <span class="hljs-selector-tag">ANSWER</span>: 2, <span class="hljs-selector-tag">AUTHORITY</span>: 0, <span class="hljs-selector-tag">ADDITIONAL</span>: 0\n\n;; <span class="hljs-selector-tag">QUESTION</span> <span class="hljs-selector-tag">SECTION</span>:\n;<span class="hljs-selector-tag">xheldon</span><span class="hljs-selector-class">.com</span>.            <span class="hljs-selector-tag">IN</span>    <span class="hljs-selector-tag">A</span>\n\n;; <span class="hljs-selector-tag">ANSWER</span> <span class="hljs-selector-tag">SECTION</span>:\n<span class="hljs-selector-tag">xheldon</span><span class="hljs-selector-class">.com</span>.        600    <span class="hljs-selector-tag">IN</span>    <span class="hljs-selector-tag">A</span>    192<span class="hljs-selector-class">.30</span><span class="hljs-selector-class">.252</span><span class="hljs-selector-class">.154</span>\n<span class="hljs-selector-tag">xheldon</span><span class="hljs-selector-class">.com</span>.        600    <span class="hljs-selector-tag">IN</span>    <span class="hljs-selector-tag">A</span>    192<span class="hljs-selector-class">.30</span><span class="hljs-selector-class">.252</span><span class="hljs-selector-class">.153</span>\n\n;; <span class="hljs-selector-tag">Query</span> <span class="hljs-selector-tag">time</span>: 462 <span class="hljs-selector-tag">msec</span>\n;; <span class="hljs-selector-tag">SERVER</span>: 172<span class="hljs-selector-class">.168</span><span class="hljs-selector-class">.200</span><span class="hljs-selector-class">.110</span><span class="hljs-selector-id">#53</span>(172<span class="hljs-selector-class">.168</span><span class="hljs-selector-class">.200</span><span class="hljs-selector-class">.110</span>)\n;; <span class="hljs-selector-tag">WHEN</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Mar</span> 30 12<span class="hljs-selector-pseudo">:32</span><span class="hljs-selector-pseudo">:23</span> 2017\n;; <span class="hljs-selector-tag">MSG</span> <span class="hljs-selector-tag">SIZE</span>  <span class="hljs-selector-tag">rcvd</span>: 61\n</code></pre>\n'}});